<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">

<title>Fetch API Example</title>

<link rel="stylesheet" href="/css/style.css">
</head>

<body>

<div class="container">

  <div class="status-200">
    <button class="btn-200">正常終了するリクエスト(ステータスコード:200)</button>
  </div><!-- /.status-200 -->

  <div class="status-400">
    <button class="btn-400">クライアントエラーが返されるリクエスト(ステータスコード:400)</button>
  </div><!-- /.status-400 -->

  <div class="status-500">
    <button class="btn-500">サーバーエラーが返されるリクエスト(ステータスコード:500)</button>
  </div><!-- /.status-500 -->

</div><!-- /.container -->


<script src="js/fetch.js"></script>
<script src="js/promise.js"></script>
<script>
/*** レスポンスを処理するハンドラを定義 ***/

// レスポンスに対して共通で行う前処理
var prepare = function(response) {
  // ステータスコードとステータステキストを表示
  console.info('status: ', response.status);
  console.info('statusText: ', response.statusText);

  // レスポンスボディをJSONとしてパース
  return response.json();
}

// 正常終了時の処理
var onFulfilled = function(data) {
  var message = ([
    '成功ハンドラで処理されました。',
    'data: ' + JSON.stringify(data, null, '  '),
  ]).join('\n');

  alert(message);
};

// エラー終了時の処理
var onRejected = function(err) {
  var message = ([
    '失敗ハンドラで処理されました。',
    'err: ' + JSON.stringify(err, null, '  '),
  ]).join('\n');

  alert(message);
};


/*** ボタンを押したときのイベントを設定 ***/

document.querySelector('.btn-200')
  .addEventListener('click', function(e) {
    e.preventDefault();

    // '/api/200' に GET リクエストを投げる
    fetch('/api/200')
      .then(prepare)
      .then(onFulfilled)
      .catch(onRejected);
  }, true);


document.querySelector('.btn-400')
  .addEventListener('click', function(e) {
    e.preventDefault();

    // '/api/400' に GET リクエストを投げる
    fetch('/api/400')
      .then(prepare)
      .then(onFulfilled)
      .catch(onRejected);
  }, true);


document.querySelector('.btn-500')
  .addEventListener('click', function(e) {
    e.preventDefault();

    // '/api/500' に GET リクエストを投げる
    fetch('/api/500')
      .then(prepare)
      .then(onFulfilled)
      .catch(onRejected);
  }, true);
</script>

</body>
</html>
